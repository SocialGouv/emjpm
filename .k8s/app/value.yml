image:
  repository: registry.gitlab.factory.social.gouv.fr/socialgouv/emjpm/app
  tag: latest

deployment:
  livenessProbe:
    initialDelaySeconds: 45
  readinessProbe:
    initialDelaySeconds: 45

  resources:
    limits:
      cpu: 250m
      memory: 128Mi
    requests:
      cpu: 25m
      memory: 64Mi

  env:
  - name: PORT
    value: "80"
  - name: NODE_ENV
    value: "production"
  - name: API_URL
    value: "//${API_HOST}"
  - name: GRAPHQL_SERVER_URI
    value: "//${HASURA_HOST}/v1/graphql"
  - name: VERSION
    value: "${VERSION}"
  - name: SENTRY_PUBLIC_DSN
    valueFrom:
      secretKeyRef:
        name: emjpm-secret
        key: SENTRY_PUBLIC_DSN

ingress:
  enabled: true
  annotations:
    appgw.ingress.kubernetes.io/ssl-redirect: "true"
    certmanager.k8s.io/cluster-issuer: letsencrypt-staging
    kubernetes.io/ingress.class: "azure/application-gateway"
    kubernetes.io/tls-acme: "true"
  hosts:
    - host: emjpm.dev.fabrique.social.gouv.fr
      paths:
        - /
  tls:
    - hosts:
        - emjpm.dev.fabrique.social.gouv.fr
      secretName: emjpm-certificate-app
