---
dist: xenial

language: node_js
node_js: 10

cache: yarn
git:
  depth: 5

#

before_install:
  - curl -o- -L https://yarnpkg.com/install.sh | bash 
  - export PATH="$HOME/.yarn/bin:$PATH
before_script:
  - docker-compose up -d elasticsearch
script:
  - yarn build --stream
  - yarn lint --stream
  - node packages/code-du-travail-api/tests/create_indexes.js
  - yarn run -- test --stream -- --coverage
after_success: npx codecov
